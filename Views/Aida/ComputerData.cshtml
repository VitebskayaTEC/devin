@model Report

@using (var db = new DevinContext())
{
    string id = "aida" + Model.ID;

    <div class="title-wrapper" id="@id">
        <a class="title" href="##@(id)">Открыть карточку компьютера</a>
    </div>

    var excludeGroups = new[] { "DMI", "Ввод" };
    var excludeFields = new[] { "DMI", "Ввод" };
    var excludeValues = new[] { "DMI", "Ввод" };

    var items = db.Item
        .Where(x => x.ReportID == Model.ID && x.IPage == "Суммарная информация")
        .Select(x => new { x.IGroup, x.IField, x.IValue })
        .Where(x => !excludeFields.Contains(x.IGroup))
        .Where(x => !excludeFields.Contains(x.IField))
        .Where(x => !excludeValues.Contains(x.IValue))
        .GroupBy(x => new { x.IGroup, x.IField, x.IValue })
        .Select(x => new Item { IGroup = x.Key.IGroup, IField = x.Key.IField, IValue = x.Key.IValue })
        .OrderBy(x => x.IGroup)
        .ThenBy(x => x.IField)
        .ThenBy(x => x.IValue)
        .ToList();

    var groups = new Dictionary<string, Dictionary<string, string>>();
    int i = 1;

    foreach (var item in items)
    {
        if (groups.ContainsKey(item.IGroup))
        {
            if (groups[item.IGroup].ContainsKey(item.IField))
            {
                item.IField = item.IField + " " + i++;
            }
            else
            {
                i = 0;
            }
            groups[item.IGroup].Add(item.IField, item.IValue);
        }
        else
        {
            var dict = new Dictionary<string, string> { { item.IField, item.IValue } };
            groups.Add(item.IGroup, dict);
        }
    }

    foreach (var group in groups.Keys)
    {
        <div class="aida__group">
            <b class="aida__group_header">@group</b>
            <table class="items">
                @foreach (var field in groups[group].Keys)
                {
                    <tr>
                        <td width="300px">@field</td>
                        <td>@groups[group][field]</td>
                    </tr>
                }
            </table>
        </div>
    }
}
